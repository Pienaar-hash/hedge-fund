# v7.6 Testing

## Lanes & Markers
- Markers: `unit`, `integration`, `runtime`, `legacy`.
- Directories: `tests/unit/` (fast, pure), `tests/integration/` (state/telemetry), `tests/legacy/` (opt-in historical).

## Commands
- Fast lane (default): `make test-fast`  
  Runs unit + integration excluding runtime/legacy.
- Runtime slice: `make test-runtime`  
  For stateful/schema/liveness checks.
- Full sweep: `make test-all`  
  Includes legacy.

## Rules
- Unit tests: no filesystem or network; deterministic.
- Integration: use `tmp_path` to isolate state; extend schema tests when changing state surfaces.
- Runtime: opt-in only; can rely on real logs/state layout.
- Legacy: may fail; do not block CI green bar.

## Coverage Highlights
- State schema: `tests/integration/test_state_files_schema.py`, `test_manifest_state_contract.py`.
- Diagnostics: `test_veto_metrics.py`, `test_state_publish_diagnostics.py`, `test_exit_pipeline_contract.py`.
- Positions/ledger: `test_state_positions_contract.py`, `test_state_positions_ledger_contract.py`, `test_state_publish_positions_ledger.py`.
- NAV/risk/router: nav anomaly/age tests, risk/router suites under integration.

## Contributor Checklist
- Add markers to new tests.
- Keep `make test-fast` green before submitting patches.
- When touching state/telemetry, run `make test-runtime`.
- Update loaders + schema tests when adding state fields.
