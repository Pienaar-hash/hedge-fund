# GPT-Hedge v7.6 — Stability & Risk Controls Overview

Internal document summarizing the stability and risk control improvements in v7.6. Suitable for investor deck input or internal risk committee review.

---

## Executive Summary

v7.6 represents a **stability and governance upgrade**, not a new alpha strategy release. The focus is on institutional-grade execution quality, robust risk controls, and operational visibility. Key improvements include router microstructure intelligence, multi-factor governance with orthogonalization, unified exit/ledger authority, NAV anomaly detection, and comprehensive diagnostic surfaces.

---

## 1. Execution & Microstructure Controls

### Router Quality Scoring
- **Per-symbol execution metrics**: slippage (bps), latency (ms), TWAP usage tracked in real-time
- **Quality buckets**: symbols classified as A_HIGH / B_MEDIUM / C_LOW based on execution quality
- **Slippage drift detection**: early warning when execution quality degrades (GREEN → YELLOW → RED)
- **Latency monitoring**: FAST / NORMAL / SLOW classification with configurable thresholds

### TWAP Execution Visibility
- Child order fill ratio tracking
- TWAP usage ratio per symbol and portfolio-wide
- TWAP skip penalty in quality scoring when appropriate

### Impact
- **Reduced execution noise**: quality-based routing prioritizes symbols with better microstructure
- **Early degradation detection**: slippage drift and latency buckets surface issues before they accumulate
- **Visibility for review**: router_health.json provides auditable execution quality history

---

## 2. Risk & Drawdown Governance

### NAV Anomaly Guards
- **Max NAV jump detection**: flags when NAV changes more than threshold between updates
- **Configurable sensitivity**: `max_nav_jump_pct` parameter in risk limits
- **Anomaly surfacing**: `nav_jump` flag in risk_snapshot.json for review

### Drawdown State Machine
- **State transitions**: NORMAL → DRAWDOWN → RECOVERY with hysteresis
- **Flap detection**: flags rapid state oscillations (`dd_flap` anomaly)
- **Governance visibility**: DD state displayed in dashboard regime strip

### VaR/CVaR Computation
- **Rolling window calculation**: configurable lookback period
- **Limit enforcement**: `var_limit_nav_pct` and `cvar_limit_nav_pct` thresholds
- **Breach flags**: `var_limit_breach` and `cvar_limit_breach` in anomalies block
- **Risk mode integration**: influences overall risk posture

### Impact
- **Earlier risk visibility**: anomaly flags surface structural risk before PnL impact
- **Governance checkpoints**: DD state transitions logged for review
- **Limit discipline**: VaR/CVaR limits provide quantitative risk boundaries

---

## 3. Exit & Ledger Integrity

### Unified Position Ledger
- **Single source of truth**: position ledger merges exchange positions with TP/SL registry
- **Atomic updates**: ledger written every executor loop with consistent state
- **Exit scanner integration**: uses ledger-first lookup for TP/SL levels

### Reconciliation & Mismatch Detection
- **Ledger-registry reconciliation**: identifies discrepancies between data sources
- **Mismatch breakdown**: counts for missing positions, ghost entries, missing/stale TP/SL
- **Underwater detection**: flags positions without TP/SL that are in loss

### Exit Coverage Metrics
- **Coverage percentage**: TP/SL registered / open positions
- **Visibility threshold**: configurable minimum coverage for healthy status
- **Dashboard display**: exit coverage visible in diagnostics panel

### Impact
- **Higher exit reliability**: ledger-first approach reduces "stuck" position risk
- **Discrepancy detection**: mismatch breakdown identifies integration issues early
- **Operational confidence**: coverage metrics provide objective exit health measure

---

## 4. Factor Governance & Attribution

### Orthogonalized Factor Model
- **Factor set**: trend, carry, rv_momentum, router_quality, expectancy, vol_regime
- **Gram-Schmidt orthogonalization**: removes factor overlap and redundancy
- **Degeneracy detection**: flags when factors become linearly dependent

### IR-Based Factor Weighting
- **Information Ratio weighting**: factors weighted by risk-adjusted performance
- **Configurable bounds**: min/max weight constraints prevent over-concentration
- **EMA smoothing**: weight changes are smoothed to reduce turnover

### PnL Attribution
- **Factor-level attribution**: PnL sliced by factor contribution
- **Lookback configuration**: attribution window configurable
- **Diagnostic surface**: full attribution published to factor_diagnostics.json

### Impact
- **Disciplined factor risk**: orthogonalization prevents double-counting correlated signals
- **Adaptive weighting**: IR-based weights respond to factor performance
- **Attribution visibility**: factor-level PnL enables performance diagnosis

---

## 5. Operational Safety Nets

### Single-Writer State Contract
- **Atomic writes**: all state files written via temp file + atomic replace
- **Single writer per file**: executor owns all runtime state surfaces
- **Schema enforcement**: integration tests validate required fields

### Timestamp Coherence
- **Required timestamps**: all state surfaces include `updated_ts` or `updated_at`
- **Freshness monitoring**: dashboard surfaces staleness indicators
- **Stale tolerance**: missing/stale surfaces handled gracefully with safe defaults

### Preflight & Sanity Checks
- **Pre-tag validation**: `make pretag-v7.6` validates version and runs targeted tests
- **Runtime sanity check**: `runtime_sanity_check_v7_6.py` verifies live system health
- **CI integration**: preflight gates tag creation

### Dashboard Regime Visibility
- **Regime strip**: horizontal badge bar shows Vol/DD/Router/Risk regimes
- **Color-coded status**: green/yellow/orange/red based on severity
- **Human oversight**: clear visual indicators for operational state

### Impact
- **Reduced state corruption risk**: atomic writes prevent partial/inconsistent state
- **Deployment confidence**: preflight checks catch issues before production
- **Operational awareness**: regime strip provides at-a-glance system health

---

## 6. Summary

v7.6 is a **stability upgrade** that strengthens the operational foundation of GPT-Hedge:

1. **Execution quality is now measurable and visible** through router microstructure metrics
2. **Risk governance is quantified** with NAV anomaly guards, DD state machine, and VaR/CVaR limits
3. **Exit reliability is improved** through unified ledger authority and mismatch detection
4. **Factor risk is disciplined** with orthogonalization and IR-based weighting
5. **Operational safety is hardened** with atomic state contracts, preflight checks, and dashboard visibility

These improvements reduce operational risk, increase transparency, and provide the infrastructure necessary for institutional-grade trading operations.

---

## Appendix: Key Metrics

| Metric | Source | Description |
|--------|--------|-------------|
| Router Quality Score | router_health.json | 0-1 score based on slippage, latency, TWAP |
| DD State | risk_snapshot.json | NORMAL/DRAWDOWN/RECOVERY |
| VaR (% NAV) | risk_snapshot.json | Rolling value-at-risk |
| CVaR (% NAV) | risk_snapshot.json | Rolling conditional VaR |
| Exit Coverage | diagnostics.json | TP/SL registered / open positions |
| Factor Weights | factor_diagnostics.json | IR-weighted factor allocations |
| NAV Jump Flag | risk_snapshot.json | True if NAV changed > threshold |

---

## Related Documentation

- [v7.6 Release Notes](v7.6_Release_Notes.md) — operator-facing summary
- [v7.6 Change Log](v7.6_Change_Log.md) — developer-facing details
- [v7.6 Architecture](v7.6_Architecture.md) — technical architecture
- [v7.6 State Contract](v7.6_State_Contract.md) — state surface specifications
