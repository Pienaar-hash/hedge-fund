# GPT-Hedge v7.6 — Institutional Execution & Factor Governance

## Overview

v7.6 represents a significant maturity milestone for GPT-Hedge, delivering institutional-grade execution quality, robust factor governance, and hardened state contracts. This release introduces router microstructure intelligence with per-symbol quality scoring, a fully orthogonalized multi-factor model with IR-based auto-weighting, unified exit/ledger authority, NAV anomaly guards with VaR/CVaR limit enforcement, and a comprehensive dashboard regime strip for operational visibility.

The focus is on **stability, observability, and operational safety** rather than new alpha sources. All changes are forward-compatible and designed for safe production rollout.

---

## Headline Features

### Router Microstructure & Router Health v2
- **RouterStats accumulator** tracks per-symbol slippage, latency, and TWAP usage in real-time
- **Quality scoring** with slippage drift buckets (GREEN/YELLOW/RED), latency buckets (FAST/NORMAL/SLOW), and router quality tiers (A_HIGH/B_MEDIUM/C_LOW)
- **router_health.json v2** with global + per-symbol metrics including child order fill ratios
- Configurable thresholds via `config/strategy_config.json` router_quality block

### Hybrid Scoring with Vol Regime & Router Quality
- Hybrid alpha score now incorporates `vol_regime` and `router_quality` factors
- Regime-aware sizing adjustments based on volatility environment
- Router quality factor penalizes symbols with degraded execution quality

### Factor Diagnostics (Orthogonalization, Covariance, IR Weights)
- **Gram-Schmidt orthogonalization** removes factor redundancy with degeneracy detection
- **Factor covariance/correlation matrix** computation with volatility estimates
- **IR-based auto-weighting** with configurable min/max bounds and EMA smoothing
- **PnL attribution** surface for factor-level performance analysis
- Published to `factor_diagnostics.json` with full analytics surface

### Exit Pipeline & Ledger Authority
- **Position ledger** is the canonical source of truth for positions + TP/SL levels
- **Ledger-registry reconciliation** with `mismatch_breakdown` counts
- **Exit coverage metrics**: TP/SL coverage %, underwater-without-TP/SL count
- Exit scanner uses ledger-first lookup with registry fallback

### NAV & Risk Snapshot Coherence + Anomaly Guards
- **NAV anomaly detection** for max NAV jumps between updates
- **DD state machine** (NORMAL/DRAWDOWN/RECOVERY) with flap detection
- **VaR/CVaR computation** with configurable limits and breach flags
- All risk signals flow into `risk_snapshot.json` with `anomalies` block

### Unified Dashboard Regime Strip
- **Vol Regime badge**: LOW/NORMAL/ELEVATED/HIGH based on realized volatility
- **DD State badge**: NORMAL/DRAWDOWN/RECOVERY with color coding
- **Router Quality badge**: global quality score with degraded/idle alerts
- **Risk Mode badge**: current risk posture from risk_snapshot

### State Contract & Telemetry Hardening
- Single-writer atomic surfaces for all state files
- Timestamp coherence enforcement (`updated_ts` required on all surfaces)
- Schema validation via integration tests
- Missing/stale surfaces treated as soft failures with safe defaults

### Preflight & Runtime Sanity Checks (v7.6)
- `make pretag-v7.6` target for pre-release validation
- `scripts/runtime_sanity_check_v7_6.py` for runtime health verification
- VERSION metadata and engine_metadata.json for version tracking
- CI workflow gates on preflight pass

---

## Operational Impact

### Dashboard Changes
- **Regime strip** at top of dashboard shows Vol/DD/Router/Risk badges
- **Router health panel** displays global + per-symbol execution quality
- **Factor diagnostics panel** shows weights, IR, orthogonalization status
- **Exit coverage** visible in diagnostics with mismatch breakdown
- **System health panel** displays engine version and surface freshness

### Incident Response Improvements
- **Router degradation**: visible in router_health.json and dashboard badge; triggers alerts when quality drops below threshold
- **Exit failures**: mismatch_breakdown identifies missing ledger positions, ghost entries, missing/stale TP/SL
- **NAV anomalies**: anomaly flags in risk_snapshot surface jump events before they cascade
- **DD breaches**: dd_state transitions are logged and surfaced for governance review

### Preflight Requirements
Before enabling v7.6 in production:
1. Run `make pretag-v7.6` — validates version, runs targeted integration tests
2. Run `python scripts/runtime_sanity_check_v7_6.py` — verifies state surface health
3. Confirm dashboard renders all regime badges and panels
4. Verify router_health.json and factor_diagnostics.json are populated

---

## Upgrade Notes

### Minimum Steps: v7.5 → v7.6

1. **Pull tag / deploy container**
   ```bash
   git fetch --tags
   git checkout v7.6
   # OR: docker pull <registry>/gpt-hedge:v7.6
   ```

2. **Run preflight validation**
   ```bash
   make pretag-v7.6
   python scripts/runtime_sanity_check_v7_6.py
   ```

3. **Restart services**
   ```bash
   sudo supervisorctl restart hedge:
   ```

4. **Verify state surfaces**
   - Check `logs/state/*.json` timestamps are fresh
   - Confirm `engine_metadata.json` shows `version: v7.6`
   - Dashboard regime strip renders correctly

5. **Post-activation validation**
   - Router health metrics populated
   - Exit coverage > 90% (or your configured threshold)
   - Factor diagnostics panel shows weights/IR
   - No repeated errors in executor logs

---

## Known Limitations / Future Work

- **Multi-exchange router**: current router supports Binance only; no cross-exchange routing
- **Latency arbitrage**: no sub-millisecond latency optimization or co-location support
- **Factor ML**: orthogonalization is static Gram-Schmidt; no dynamic factor selection via ML
- **Real-time PnL attribution**: attribution is snapshot-based, not streaming
- **Alert fatigue**: anomaly flags are surfaced but alerting thresholds not fully tuned
- **Backtest integration**: factor diagnostics not yet integrated into research/backtest pipeline

---

## Related Documentation

- [v7.6 Change Log](v7.6_Change_Log.md) — developer-facing detailed changes
- [v7.6 Runtime Activation Runbook](v7.6_Runtime_Activation.md) — ops/SRE deployment guide
- [v7.6 Investor Stability Summary](v7.6_Investor_Stability.md) — risk controls overview
- [v7.6 Pre-Tag Audit](v7.6_Pre_Tag_Audit.md) — validation checklist
- [v7.6 State Contract](v7.6_State_Contract.md) — canonical state surface specifications
- [v7.6 Architecture](v7.6_Architecture.md) — runtime flow and module boundaries
