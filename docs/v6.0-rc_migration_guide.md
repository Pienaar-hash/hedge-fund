# v6.0-rc Migration Guide

This guide covers the concrete steps needed to promote an environment from the v5.x tree to the current v6.0-rc snapshot that lives entirely inside this repo.

## 1. Update runtime configs
1. Refresh risk + universe files from source control:
   - `config/risk_limits.json:1-74` – ensure per-symbol caps cover BTC/ETH/SOL/LINK/LTC/SUI/WIF with the NAV/ordering constraints baked into this repo.
   - `config/pairs_universe.json:1-80` – enable only the symbols you are ready to trade; disabled entries keep their tier metadata for future releases.
   - `config/runtime.yaml:1-25` – confirm trading-window, offpeak, and priority min-child settings match your venue.
2. If you previously relied on external config bundles or legacy dashboards, delete them. Every consumer now reads the files listed above straight from `/root/hedge-fund/config`.

## 2. Align Supervisor + environment
1. Replace any legacy Supervisor configs with `ops/hedge.conf:1-52`. This file boots exactly five programs (executor, dashboard, sync_state, pipeline heartbeat, pipeline compare) and sets `PYTHONPATH=/root/hedge-fund`.
2. Export v6 env flags explicitly for each process (or rely on defaults):
   - `INTEL_V6_ENABLED`, `RISK_ENGINE_V6_ENABLED`, `PIPELINE_V6_SHADOW_ENABLED`, `ROUTER_AUTOTUNE_V6_ENABLED`, `FEEDBACK_ALLOCATOR_V6_ENABLED`, `ROUTER_AUTOTUNE_V6_APPLY_ENABLED` (see `execution/v6_flags.py:18-59`).
3. Ensure `ALLOW_PROD_WRITE=1` and `ALLOW_PROD_SYNC=1` are set on executor + sync_state in production. Without those overrides, both programs bail out early (`execution/state_publish.py:35-45`, `execution/sync_state.py:34-69`).

## 3. Seed telemetry directories
1. Clean/initialize the `logs/` tree:
   - `logs/state/` must exist and be writable by Supervisor. Executor writes nav/positions/risk/synced/expectancy/scores/suggestions/pipeline state via `execution/state_publish.py:77-190`.
   - Remove stale v5 files (legacy dashboard caches, multi_strategy artifacts). Only the files enumerated in `v6_state_contract.md` are used.
2. Run `scripts/expectancy_v6_builder.py` and `scripts/feedback_allocator_probe_v6.py` once to backfill `expectancy_v6.json`, `symbol_scores_v6.json`, and `risk_allocation_suggestions_v6.json` before enabling Router Auto Apply.

## 4. Validate runtime health
1. Start Supervisor and monitor `logs/execution/*.log` plus `logs/state/*.json`. `_pub_tick()` (`execution/executor_live.py:3291-3358`) should log `[v6-runtime] state write complete ...` within the first minute.
2. Check `logs/state/v6_runtime_probe.json` to ensure the flag combo you expect was recorded (`execution/executor_live.py:237-251`).
3. Verify `logs/state/pipeline_v6_shadow_head.json` and `logs/state/pipeline_v6_compare_summary.json` update within their intervals. Use `scripts/pipeline_shadow_heartbeat.py`/`scripts/pipeline_compare_service.py` manually if needed.

## 5. Testing & sign-off
1. Run `pytest tests/test_executor_state_files.py tests/test_v6_runtime_activation.py tests/test_pipeline_v6_shadow.py tests/test_pipeline_v6_compare_runtime.py tests/test_router_autotune_v6.py tests/test_router_autotune_apply_v6.py tests/test_feedback_allocator_v6.py` to confirm the critical contracts before shipping.
2. Tag the release by updating `VERSION` so `_ENGINE_VERSION` reflects v6.0-rc (`execution/executor_live.py:116-120`) and rebuild containers.

Following the steps above migrates every runtime component onto the v6.0-rc contract with no leftover references to legacy dashboards or v5 telemetry.
