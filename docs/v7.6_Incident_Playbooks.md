# v7.6 Incident Playbooks

Use canonical state files and diagnostics as the first source of truth. Never edit `logs/state/*` manually.

## System Alive but Not Trading
- **Signals**: liveness `idle_signals/idle_orders/idle_router` true; no new orders in `orders_executed.jsonl`.
- **Check**: `diagnostics.json` veto heatmap; `risk_snapshot.json` for risk_mode/dd_state; `positions_state.json` timestamp.
- **Actions**: fix config if veto storm intentional; otherwise restart executor and confirm `last_signal_ts/last_order_ts` advance. Verify min_notional vs runtime sizing in `risk_limits.json` and `runtime.yaml`.

## Exit Pipeline Not Triggering
- **Signals**: `diagnostics.exit_pipeline.tp_sl_missing_count` > 0; `underwater_without_tp_sl_count` > 0; `idle_exits` true.
- **Check**: `positions_ledger.json` coverage; `position_tp_sl.json` registry; `mismatch_breakdown` in diagnostics for missing vs ghost entries; price map feeding exit scanner.
- **Actions**: run `scripts/seed_exit_registry_from_open_positions.py`; restart executor; ensure `last_exit_scan_ts/last_exit_trigger_ts` advance and coverage_pct rises.

## positions_state.json Frozen
- **Signals**: `positions_state.json` `updated_at` stale; dashboard positions empty.
- **Check**: executor logs for write failures; `diagnostics.liveness.idle_orders`/`idle_router`; `positions.json` snapshot.
- **Actions**: restart executor; validate disk space/permissions; ensure no other writer touches `positions_state.json`.

## Ledger Mismatch Detected
- **Signals**: `diagnostics.exit_pipeline.ledger_registry_mismatch` true; coverage_pct < 1.0.
- **Check**: compare `positions_ledger.json` entries to TP/SL registry; `mismatch_breakdown` shows missing_ledger/missing_tp_sl; look for symbols missing TP/SL.
- **Actions**: rebuild ledger (restart executor), seed registry, re-run exit scanner; watch coverage climb to 1.0.

## Router Idle Too Long
- **Signals**: `idle_router` true; `last_router_event_ts` stale; few/no orders.
- **Check**: router logs; runtime config for min child notional; veto heatmap for router-related vetoes.
- **Actions**: restart executor; adjust sizing/runtime cfg if intents too small to route; confirm `last_router_event_ts` updates.

## NAV Anomaly Detected
- **Signals**: abrupt jump in `nav_state.json`; drawdown resets unexpectedly; risk mode flapping.
- **Check**: `nav.json` vs `nav_state.json`; `risk_limits.json` nav_anomalies thresholds; `logs/execution/risk_vetoes.jsonl`.
- **Actions**: tighten nav anomaly guard temporarily; pin nav to last good value if needed; restart executor and monitor stability.

## Veto Storm (All Signals Blocked)
- **Signals**: `veto_counters.by_reason` dominated by one reason; total_vetoes spikes.
- **Check**: `risk_snapshot.json` circuits; `risk_limits.json` caps; `diagnostics.json` timestamps to ensure loop alive.
- **Actions**: adjust offending limit only if intentional; otherwise revert config, restart executor, confirm new signals/orders flow.
