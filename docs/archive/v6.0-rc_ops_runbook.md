# ðŸŸ© **2. v6.0-rc Ops Runbook**

File: `docs/v6.0-rc_ops_runbook.md`

---

# **GPT-Hedge v6.0-rc â€” Ops Runbook**

## **Purpose**

Operational steps for deploying the v6.0-rc runtime on Stage or Prod under Supervisor.

---

## **1. Pre-Deploy Checklist**

### **1.1 Pull latest code**

```
git checkout main
git pull
```

### **1.2 Confirm VERSION**

```
cat VERSION
# Expect: v6.0-rc <date>
```

### **1.3 Check config files**

* `config/risk_limits.json`
* `config/pairs_universe.json`
* `config/runtime.yaml`

Must match venue deployment profile.

---

## **2. Directory Setup**

```
mkdir -p logs/state logs/execution logs/cache logs/pipeline
chmod -R 755 logs
```

Remove legacy v5 caches if present.

---

## **3. Seed Intel (Optional but Recommended)**

```
python3 scripts/expectancy_v6_builder.py
python3 scripts/feedback_allocator_probe_v6.py
```

Confirm the presence of:

* `logs/state/expectancy_v6.json`
* `logs/state/symbol_scores_v6.json`
* `logs/state/risk_allocation_suggestions_v6.json`

---

## **4. Supervisor Deployment**

Place `ops/hedge.conf` into Supervisor:

```
sudo cp ops/hedge.conf /etc/supervisor/conf.d/hedge.conf
sudo supervisorctl reread
sudo supervisorctl update
sudo supervisorctl restart hedge:
```

Processes started:

1. executor
2. sync_state
3. dashboard
4. pipeline_shadow_heartbeat
5. pipeline_compare_service

---

## **5. Runtime Verification**

### **5.1 Check v6 runtime probe**

```
cat logs/state/v6_runtime_probe.json
```

Confirm:

* `engine_version` == VERSION
* v6 flags set correctly

### **5.2 Check synced state**

```
cat logs/state/synced_state.json
```

Confirm:

* `items` list
* `nav` float
* `engine_version`
* `v6_flags`
* `updated_at`

---

## **6. Pipeline Monitoring**

After restart:

* Expect `is_warmup = true` for first ~200 decisions.
* Once sample > threshold â†’ warms up: `is_warmup = false`.

Monitor:

```
logs/state/pipeline_v6_compare_summary.json
```

---

## **7. Router Auto-Apply Monitoring**

Check logs:

```
grep router_apply logs/execution/*.jsonl
```

Look for:

* `"router_apply_missing_allocator"`
* `"router_apply_stale_allocator"`
* `"router_apply_fresh_defensive"`
* `"router_apply_applied_policy"`

Enable auto-apply only once allocator + router health stabilise.

---

## **8. sync_state & Firestore**

Ensure:

```
ALLOW_PROD_WRITE=1
ALLOW_PROD_SYNC=1
```

Check Firestore correct population:

* NAV doc populated
* Positions doc populated

---

## **9. Pre-Release Test Suite**

```
pytest \
 tests/test_v6_runtime_activation.py \
 tests/test_executor_state_files.py \
 tests/test_pipeline_v6_compare_runtime.py \
 tests/test_router_autotune_apply_v6.py
```

All must pass (>95% relevance to v6 runtime).
