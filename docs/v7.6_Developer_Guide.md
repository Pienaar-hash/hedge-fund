# v7.6 Developer Guide

## Entrypoints
- Executor: `execution/executor_live.py` (main loop screener → risk → router → exit scanner); writes all canonical state files.
- Dashboard: `dashboard/app.py` + loaders in `dashboard/state_v7.py` (read-only).
- Sync: `execution/sync_state.py` (owns only `nav_state.json` mirror).

## Repo Layout
- `execution/`: runtime (risk_limits, risk_engine_v6, order_router, exit_scanner, position_ledger, state_publish, diagnostics_metrics).
- `dashboard/`: Streamlit panels + loaders.
- `config/`: strategy_config.json, risk_limits.json, runtime.yaml, pairs_universe.json, symbol_tiers.json.
- `tests/`: `unit/`, `integration/`, `legacy/` (marked).
- `docs/`: v7.6 architecture/state/diagnostics/testing/agent guides; archive for v5/v6.

## State & Diagnostics Rules
- Single writer per file (executor owns everything except `nav_state.json`).
- Atomic writes only; see `state_publish.py` helpers.
- Surfaces: nav, nav_state, positions_state, positions_ledger, kpis_v7, diagnostics, risk_snapshot, router_health, symbol_scores, rv_momentum, factor_diagnostics.
- Liveness/coverage: diagnostics include veto counts, exit coverage %, router activity, missing timestamp flags.

## Tests & Lanes
- Markers: `unit`, `integration`, `runtime`, `legacy`.
- Commands: `make test-fast` (unit+integration, no runtime/legacy), `make test-runtime`, `make test-all`.
- Guidelines: unit = pure/fast/no FS; integration = tmp_path for state; runtime = manual/opt-in; legacy may fail and is informational.

## Adding Features
- New state fields: add via `state_publish` writer, update loader (dashboard/state_v7.py), extend integration schema tests.
- New diagnostics counters: add to `diagnostics_metrics`, surface in `write_runtime_diagnostics_state`, render in dashboard if needed.
- New factor/intel modules: follow pattern in `execution/factor_diagnostics.py` and `execution/intel/*`; keep pure math testable under unit lane.
- Regime badges: derived in `dashboard/state_v7.py` (vol_regime, dd_state/risk_mode, router quality) and rendered in the dashboard header; no new state writes required.

## Agent Checklist (before coding)
- Read `v7_manifest.json` for canonical surfaces/owners.
- Confirm target state file has a single writer.
- Plan tests: keep `make test-fast` green; add runtime slice only if touching state/telemetry contracts.
- Avoid modifying trading semantics unless explicitly requested.
