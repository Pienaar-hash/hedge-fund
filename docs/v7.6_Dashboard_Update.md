# v7.6 Dashboard Update

## Overview

This document describes the dashboard updates in v7.6, focusing on treasury integration and off-chain asset support.

## New Features

### 1. Treasury Panel

A new Treasury & Off-Chain Assets panel has been added to the Overview tab. This panel provides:

- **AUM Overview**: Unified view of all assets including futures NAV, off-chain holdings, and spot treasury
- **Yield Summary**: Weighted average APR and estimated daily/monthly/annual yield from treasury assets
- **Assets Detail**: Detailed table of off-chain assets with quantities, costs, and current values
- **Health Diagnostics**: State surface health monitoring for treasury data freshness

### 2. Off-Chain State Surfaces

Two new state surfaces have been added:

#### `logs/state/offchain_assets.json`
```json
{
  "assets": {
    "BTC": {
      "qty": 0.035,
      "avg_cost_usd": 3402.10,
      "current_price_usd": 97500,
      "usd_value": 3412.50,
      "source": "cointracker"
    }
  },
  "metadata": {
    "import_source": "CoinTracker CSV",
    "last_import_ts": 1733749000
  },
  "updated_ts": 1733749000
}
```

#### `logs/state/offchain_yield.json`
```json
{
  "yields": {
    "BTC": {
      "apr_pct": 1.2,
      "strategy": "lending"
    }
  },
  "updated_ts": 1733749000
}
```

### 3. New Loader Functions in `state_v7.py`

| Function | Description |
|----------|-------------|
| `load_offchain_assets()` | Load off-chain asset holdings |
| `load_offchain_yield()` | Load treasury yield rates |
| `compute_unified_aum()` | Compute total AUM across all sources |
| `compute_treasury_yield_summary()` | Calculate yield metrics |
| `get_treasury_health()` | Get treasury state health diagnostics |

## UI Updates

- Page title updated to "Hedge â€” v7.6 Dashboard"
- Runtime strip updated to reference v7.6
- Treasury panel added as expandable section in Overview tab

## File Changes

### New Files
- `dashboard/treasury_panel.py` - Treasury visualization components
- `logs/state/offchain_assets.json` - Off-chain assets state
- `logs/state/offchain_yield.json` - Treasury yield state
- `treasury/cointracker/cointracker_holdings.csv` - CoinTracker import data

### Modified Files
- `dashboard/app.py` - Added treasury panel integration
- `dashboard/state_v7.py` - Added treasury loader functions and computation

## Usage

### Viewing Treasury Data

1. Open the dashboard at `http://localhost:8501`
2. Scroll to the "Treasury & Off-Chain Assets" expander in the Overview tab
3. Click to expand and view:
   - AUM breakdown across futures, off-chain, and spot
   - Yield summary with APR and estimated returns
   - Detailed asset table
   - Health status of treasury data surfaces

### Updating Off-Chain Data

Off-chain data is managed through the state files:

```bash
# Update offchain_assets.json with new holdings
cat > logs/state/offchain_assets.json << 'EOF'
{
  "assets": {
    "BTC": {"qty": 0.05, "avg_cost_usd": 45000, "current_price_usd": 97500, "usd_value": 4875, "source": "cointracker"}
  },
  "updated_ts": $(date +%s)
}
EOF
```

### CoinTracker Integration

A CoinTracker CSV export can be placed in `treasury/cointracker/` for offline reference. The dashboard currently reads from the JSON state files, with future enhancements planned for direct CSV ingestion.

## Configuration

Treasury thresholds are defined in the loader functions:

- Stale threshold for assets: 86400 seconds (24 hours)
- Stale threshold for yield: 86400 seconds (24 hours)
- NAV freshness threshold: Uses runtime config `nav_freshness_seconds`

## Future Enhancements

1. Automated CoinTracker CSV ingestion
2. Live price updates for off-chain assets
3. Yield strategy configuration via runtime.yaml
4. Historical AUM tracking and visualization
