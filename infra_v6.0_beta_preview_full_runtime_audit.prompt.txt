# âš¡ **STEP 6 â€” Codex v6.0-beta Preview Audit Pass (YES, DO IT)**

This is the right time to run **one final Codex-wide audit sweep**, scoped only to:

* runtime wiring
* telemetry completeness
* pipeline v6 behavior under zero-trade conditions
* dashboard ingestion compatibility
* sync_state
* service configs
* missing try/except boundaries
* stale modules/files leftover from v5.10

This audit becomes the baseline for the **v6.0-beta** hardening sprint.

Below is the full Codex prompt.

---

# ðŸ§  **Codex Prompt â€” v6.0-Beta-Preview Full Runtime & Telemetry Audit**

Save as:

```
infra_v6.0_beta_preview_full_runtime_audit.prompt.txt
```

---

## **Title:**

**v6.0-beta-preview â€” Full Runtime Activation, Telemetry, and Service Wiring Audit**

## **Scope:**

Perform a top-to-bottom audit of the *running* v6 runtime pipeline and all supervisor-managed services:

* execution/executor_live.py
* execution/signal_screener.py
* execution/state_publish.py
* execution/exutil.py (env + .env loader)
* execution/intel/*_v6.py
* execution/pipeline_v6_shadow.py
* scripts/*_v6_probe.py
* dashboard/* and dashboard helpers
* sync_state
* config schema
* logs/state tree
* supervisor configs (`hedge.conf`)

## **Objectives:**

### **1. Runtime v6 flag activation**

Verify that:

* `_log_v6_flag_snapshot()` is always called at startup.
* All v6 flags (INTEL_V6_ENABLED, RISK_ENGINE_V6_ENABLED, PIPELINE_V6_SHADOW_ENABLED, ROUTER_AUTOTUNE_V6_ENABLED, FEEDBACK_ALLOCATOR_V6_ENABLED, ROUTER_AUTOTUNE_V6_APPLY_ENABLED) are parsed once, cached, and used consistently.
* No duplicate env parsing across modules.

Fix:

* inconsistent env variable names
* unused flags
* double-parsing
* missing booleans

---

### **2. Telemetry v2 completeness**

Audit:

* state_publish.py writers (nav, positions, router health, risk snapshot, intel v6 state)
* executor telemetry loop
* dashboards readers of state files
* sync_state Firestore publisher

Confirm:

* each state file is produced on interval, even if empty (but must exist)
* json schema matches docs
* no unbounded file growth or missing file rotation

---

### **3. Shadow pipeline v6 behavior**

Verify:

* pipeline_v6_shadow runs even without emitted orders
* writes `pipeline_v6_shadow_head.json`
* writes shadow JSONL logs
* captures risk-engine v6 decisions
* parquet/log sinks consistent

Fix any:

* missing imports
* missing state writers
* dead branches
* missing try/except fallback

---

### **4. Intel v6 refresh cycle**

Check whether intel v6 modules:

* load telemetry correctly
* handle empty upstream logs gracefully
* write v6 state regardless
* include timestamps and reason fields
* suppress exceptions properly

Audit:

* expectancy
* symbol scores
* router autotune suggestions
* feedback allocator suggestions
* router health ingestion

Ensure:

* refresh intervals configurable
* intervals logged in executor
* intel writes donâ€™t block executor

---

### **5. Dashboard compatibility**

Review:

* router health page
* multi-strategy dashboard
* v6 intel tables
* pipeline comparison displays

Fix:

* missing reads
* mismatched keys
* broken imports

---

### **6. Remove v5.10 legacy code**

Identify:

* dead paths in executor
* unused telemetry logic
* v5 checks that duplicate v6 engine
* old router policy metadata
* deprecated config keys
* old python scripts

Produce a cleanup plan.

---

### **7. Service wiring audit**

Verify:

* supervisor config formatting
* command paths
* working directories
* environment declarations
* logfile paths and rotate settings
* sync_state execution errors
* dashboard spawn issues

---

### **8. Deliverables**

1. `docs/infra_v6.0_beta_preview_runtime_audit.md`

   * runtime wiring map
   * telemetry schema map
   * intel v6 flow map
   * shadow pipeline flow
   * dashboard ingest summary
   * list of recommended patches

2. Codex patch suggestions

   * minimal changes per module
   * no new behavior outside v6 flags
   * non-invasive, safe patches only

3. A `Batch_12_RuntimeBetaFixes.prompt.txt` file that implements the recommended fixes.